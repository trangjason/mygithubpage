angular.module("mwFormBuilder",["ngSanitize","ng-sortable","pascalprecht.translate"]);
angular.module("mwFormBuilder").service("mwFormUuid",function(){function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}this.get=function(){return r()+r()+r()+r()+r()+r()+r()+r()}}).factory("mwFormClone",["mwFormUuid",function(r){var e={},n=[];return e.resetIds=function(t,a){if(a&&(n=[]),!(n.indexOf(t)>=0)&&(n.push(t),!t!==Object(t))){if(Array.isArray(t))return void t.forEach(e.resetIds);for(var o in t)t.hasOwnProperty(o)&&e.resetIds(t[o]);if(t.hasOwnProperty("id")){var i=r.get();t.id;t.id=i}}},e.cloneElement=function(r){var n={};return angular.copy(r,n),e.resetIds(n,!0),n},e.clonePage=function(n){var t={};angular.copy(n,t),t.id=r.get();var a=[];if(Array.isArray(n.elements))for(var o=0;o<n.elements.length;o++)a.push(e.cloneElement(n.elements[o]));return t.elements=a,t},e.cloneForm=function(r){var n={};angular.copy(r,n);var t=[];if(Array.isArray(r.pages))for(var a=0;a<r.pages.length;a++)t.push(e.clonePage(r.pages[a]));return n.pages=t,n},e}]);
angular.module("mwFormBuilder").directive("mwQuestionPriorityListBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-priority-list-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(i){function e(i){if(i)for(var e=0;e<i.length;e++){var t=i[e];t.orderNo=e+1}}function t(i){i.sort(function(i,e){return i.orderNo-e.orderNo})}var r=this;r.isNewItem={},r.addNewItem=function(e){var t={id:i.get(),orderNo:r.question.priorityList.length+1,value:null};e||(r.isNewItem[t.id]=!0),r.question.priorityList.push(t)},r.question.priorityList||(r.question.priorityList=[],r.addNewItem()),t(r.question.priorityList),r.itemsSortableConfig={disabled:r.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(i,t){e(r.question.priorityList)}},r.removeItem=function(i){var e=r.question.priorityList.indexOf(i);-1!=e&&r.question.priorityList.splice(e,1)},r.keyPressedOnInput=function(i,e){delete r.isNewItem[e.id],13===i.which&&(i.preventDefault(),r.addNewItem())}}],link:function(i,e,t,r){i.ctrl}}});
angular.module("mwFormBuilder").directive("mwQuestionOfferedAnswerListBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",formObject:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-offered-answer-list-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["FormQuestionBuilderId","mwFormUuid",function(e,r){function n(){if(s.question.offeredAnswers)for(var e=0;e<s.question.offeredAnswers.length;e++){var r=s.question.offeredAnswers[e];r.orderNo=e+1}}function o(){s.question.offeredAnswers&&s.question.offeredAnswers.sort(function(e,r){return e.orderNo-r.orderNo})}var s=this;s.config={radio:{},checkbox:{}},s.isNewAnswer={},o(),s.offeredAnswersSortableConfig={disabled:s.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,r){n()}},s.addNewOfferedAnswer=function(){var e=s.possiblePageFlow[0],n={id:r.get(),orderNo:s.question.offeredAnswers.length+1,value:null,pageFlow:e};s.isNewAnswer[n.id]=!0,s.question.offeredAnswers.push(n)},s.removeOfferedAnswer=function(e){var r=s.question.offeredAnswers.indexOf(e);-1!=r&&s.question.offeredAnswers.splice(r,1)},s.addCustomAnswer=function(){s.question.otherAnswer=!0},s.removeCustomAnswer=function(){s.question.otherAnswer=!1},s.keyPressedOnInput=function(e,r){delete s.isNewAnswer[r.id],13===e.which&&(e.preventDefault(),s.addNewOfferedAnswer())}}],link:function(e,r,n,o){var s=e.ctrl;s.possiblePageFlow=o.possiblePageFlow}}});
angular.module("mwFormBuilder").directive("mwQuestionGridBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",formObject:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-grid-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){function o(e){if(e)for(var o=0;o<e.length;o++){var r=e[o];r.orderNo=o+1}}function r(e){e.sort(function(e,o){return e.orderNo-o.orderNo})}var n=this;n.isNewInput={},n.addNewRow=function(o){var r={id:e.get(),orderNo:n.question.grid.rows.length+1,label:null};o||(n.isNewInput[r.id]=!0),n.question.grid.rows.push(r)},n.addNewCol=function(o){var r={id:e.get(),orderNo:n.question.grid.cols.length+1,label:null};o||(n.isNewInput[r.id]=!0),n.question.grid.cols.push(r)},n.question.grid||(n.question.grid={rows:[],cols:[]},n.addNewRow(),n.addNewCol(!0)),r(n.question.grid.rows),r(n.question.grid.cols),n.rowsSortableConfig={disabled:n.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,r){o(n.question.grid.rows)}},n.colsSortableConfig={disabled:n.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,r){o(n.question.grid.cols)}},n.removeRow=function(e){var o=n.question.grid.rows.indexOf(e);-1!=o&&n.question.grid.rows.splice(o,1)},n.removeCol=function(e){var o=n.question.grid.cols.indexOf(e);-1!=o&&n.question.grid.cols.splice(o,1)},n.keyPressedOnInput=function(e,o,r){delete n.isNewInput[o.id],13===e.which&&(e.preventDefault(),"row"==r?n.addNewRow():n.addNewCol())}}],link:function(e,o,r,n){e.ctrl}}});
angular.module("mwFormBuilder").directive("mwQuestionDivisionBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-division-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(i){function e(i){if(i)for(var e=0;e<i.length;e++){var n=i[e];n.orderNo=e+1}}function n(i){i.sort(function(i,e){return i.orderNo-e.orderNo})}var t=this;t.isNewItem={},t.addNewItem=function(e){var n={id:i.get(),orderNo:t.question.divisionList.length+1,value:null};e||(t.isNewItem[n.id]=!0),t.question.divisionList.push(n)},t.question.divisionList||(t.question.divisionList=[],t.addNewItem()),n(t.question.divisionList),t.itemsSortableConfig={disabled:t.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(i,n){e(t.question.divisionList)}},t.removeItem=function(i){var e=t.question.divisionList.indexOf(i);-1!=e&&t.question.divisionList.splice(e,1)},t.keyPressedOnInput=function(i,e){delete t.isNewItem[e.id],13===i.which&&(i.preventDefault(),t.addNewItem())}}],link:function(i,e,n,t){i.ctrl}}});
angular.module("mwFormBuilder").directive("mwLabel",function(){return{replace:!0,restrict:"AE",scope:{labelKey:"@?",labelText:"@?",labelFor:"@",labelClass:"@",labelTranslateValues:"="},templateUrl:"mw-label.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(l){}],link:function(l,e,r){}}});
angular.module("mwFormBuilder").factory("FormQuestionBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormQuestionBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{question:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-question-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormQuestionBuilderId","mwFormBuilderOptions",function(e,o,n){function r(){if(s.question.offeredAnswers)for(var e=0;e<s.question.offeredAnswers.length;e++)s.question.offeredAnswers[e].orderNo=e+1}function t(){s.question.offeredAnswers&&s.question.offeredAnswers.sort(function(e,o){return e.orderNo-o.orderNo})}function i(){s.question.offeredAnswers&&s.question.offeredAnswers.forEach(function(e){s.question.pageFlowModifier?e.pageFlow=s.possiblePageFlow[0]:delete e.pageFlow})}var s=this;s.id=o.next(),s.questionTypes=n.questionTypes,s.formSubmitted=!1,t(),s.save=function(){s.formSubmitted=!0,s.form.$valid&&s.onReady()},s.offeredAnswersSortableConfig={disabled:s.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,o){r()}},s.questionTypeChanged=function(){"radio"!=s.question.type&&"checkbox"!=s.question.type||s.question.offeredAnswers||(s.question.offeredAnswers=[]),"radio"!=s.question.type&&(i(),e(function(){s.question.pageFlowModifier=!1})),"radio"!=s.question.type&&"checkbox"!=s.question.type&&delete s.question.offeredAnswers,"grid"!=s.question.type&&delete s.question.grid,"priority"!=s.question.type&&delete s.question.priorityList},s.pageFlowModifierChanged=function(){i()}}],link:function(e,o,n,r){var t=e.ctrl;t.possiblePageFlow=r.possiblePageFlow,t.options=r.options}}});
angular.module("mwFormBuilder").factory("FormParagraphBuilderId",function(){var r=0;return{next:function(){return++r}}}).directive("mwFormParagraphBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{paragraph:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-paragraph-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormParagraphBuilderId",function(r,e){var t=this;t.id=e.next(),t.formSubmitted=!1,t.save=function(){t.formSubmitted=!0,t.form.$valid&&t.onReady()}}],link:function(r,e,t,o){r.ctrl}}});
angular.module("mwFormBuilder").directive("mwFormPageElementBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageBuilder",scope:{pageElement:"=",formObject:"=",isActive:"=",isFirst:"=",isLast:"=",onReady:"&",readOnly:"=?"},templateUrl:"mw-form-page-element-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){var t=this;t.callback=function(e,n){e.preventDefault(),e.stopPropagation(),n.callback&&"function"==typeof n.callback&&n.callback(t.pageElement)},t.filter=function(e){return!e.showInOpen&&t.isActive?!1:e.showInPreview||t.isActive?e.filter&&"function"==typeof e.filter?e.filter(t.pageElement):!0:!1},"question"==t.pageElement.type?t.pageElement.question||(t.pageElement.question={id:e.get(),text:null,type:null,required:!0}):"image"==t.pageElement.type?t.pageElement.image||(t.pageElement.image={id:e.get(),align:"left"}):"paragraph"==t.pageElement.type&&(t.pageElement.paragraph||(t.pageElement.paragraph={id:e.get(),html:""}))}],link:function(e,t,n,l){var o=e.ctrl;o.possiblePageFlow=l.possiblePageFlow,o.hoverIn=function(){o.isHovered=!0},o.hoverOut=function(){o.isHovered=!1},o.editElement=function(){l.selectElement(o.pageElement)},o.cloneElement=function(e){e.preventDefault(),e.stopPropagation(),l.cloneElement(o.pageElement)},o.removeElement=function(){l.removeElement(o.pageElement)},o.moveDown=function(){l.moveDownElement(o.pageElement)},o.moveUp=function(){l.moveUpElement(o.pageElement)},o.options=l.options,o.onImageSelection=l.onImageSelection}}});
angular.module("mwFormBuilder").directive("mwFormPageBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormBuilder",scope:{formPage:"=",formObject:"=",isFirst:"=",isLast:"=",readOnly:"=?"},templateUrl:"mw-form-page-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","mwFormUuid","mwFormClone","mwFormBuilderOptions",function(e,n,o,t){function r(){for(var e=0;e<i.formPage.elements.length;e++)i.formPage.elements[e].orderNo=e+1}function l(){i.formPage.elements.sort(function(e,n){return e.orderNo-n.orderNo})}function m(e,o){return{id:n.get(),orderNo:o,type:e}}function a(e,n,o){var t=e[n];e.splice(n,1),e.splice(o,0,t)}var i=this;i.hoverEdit=!1,i.formPage.namedPage=!!i.formPage.name,i.isFolded=!1,i.unfold=function(){i.isFolded=!1},i.fold=function(){i.isFolded=!0},l(),i.sortableConfig={disabled:i.readOnly,ghostClass:"beingDragged",group:"survey",handle:".inactive",chosenClass:".page-element-list",onEnd:function(e,n){r()}},i.activeElement=null,i.addElement=function(e){e||(e=t.elementTypes[0]);var n=m(e,i.formPage.elements.length+1);i.activeElement=n,i.formPage.elements.push(n)},i.cloneElement=function(e,n){var t=i.formPage.elements.indexOf(e),r=o.cloneElement(e);n&&(i.activeElement=r),i.formPage.elements.splice(t,0,r)},i.removeElement=function(e){var n=i.formPage.elements.indexOf(e);i.formPage.elements.splice(n,1)},i.moveDownElement=function(e){var n=i.formPage.elements.indexOf(e),o=n+1;o<i.formPage.elements.length&&a(i.formPage.elements,n,o),r()},i.moveUpElement=function(e){var n=i.formPage.elements.indexOf(e),o=n-1;o>=0&&a(i.formPage.elements,n,o),r()},i.isElementTypeEnabled=function(e){return-1!==t.elementTypes.indexOf(e)},i.addQuestion=function(){i.addElement("question")},i.addImage=function(){i.addElement("image")},i.addParagraph=function(){i.addElement("paragraph")},i.isElementActive=function(e){return i.activeElement==e},i.selectElement=function(e){i.activeElement=e},i.onElementReady=function(){e(function(){i.activeElement=null})},i.hoverIn=function(){i.hoverEdit=!0},i.hoverOut=function(){i.hoverEdit=!1},i.updateElementsOrderNo=r}],link:function(e,n,o,t){var r=e.ctrl;r.possiblePageFlow=t.possiblePageFlow,r.moveDown=function(){t.moveDownPage(r.formPage)},r.moveUp=function(){t.moveUpPage(r.formPage)},r.removePage=function(){t.removePage(r.formPage)},r.addPage=function(){t.addPageAfter(r.formPage)},e.$watch("ctrl.formPage.elements.length",function(e,n){e!=n&&r.updateElementsOrderNo()}),r.options=t.options,r.onImageSelection=t.onImageSelection}}});
angular.module("mwFormBuilder").factory("FormImageBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormImageBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{image:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?",onImageSelection:"&"},templateUrl:"mw-form-image-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormImageBuilderId","mwFormUuid",function(e,r,t){var n=this;n.id=r.next(),n.formSubmitted=!1,n.save=function(){n.formSubmitted=!0,n.form.$valid&&n.onReady()},n.selectImageButtonClicked=function(){var e=n.onImageSelection();e.then(function(e){n.image.src=e})["catch"](function(){})},n.setAlign=function(e){n.image.align=e}}],link:function(e,r,t,n){e.ctrl}}});
angular.module("mwFormBuilder").directive("mwFormConfirmationPageBuilder",function(){return{replace:!0,restrict:"AE",scope:{formObject:"=",readOnly:"=?"},templateUrl:"mw-form-confirmation-page-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout",function(r){var o=this;o.hoverEdit=!1,o.hoverIn=function(){o.hoverEdit=!0},o.hoverOut=function(){o.hoverEdit=!1}}],link:function(r,o,e){}}});
angular.module("mwFormBuilder").directive("mwFormBuilder",function(){return{replace:!0,restrict:"AE",scope:{formData:"=",readOnly:"=?",options:"=?",formStatus:"=?",onImageSelection:"&",api:"=?"},templateUrl:"mw-form-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid","MW_QUESTION_TYPES","mwFormBuilderOptions",function(e,a,o){function t(a){var o=null;return g.possiblePageFlow&&(o=g.possiblePageFlow[0]),{id:e.get(),number:a,name:null,description:null,pageFlow:o,elements:[]}}function r(){for(var e=0;e<g.formData.pages.length;e++)g.formData.pages[e].number=e+1;g.updatePageFlow()}function n(e,a,o){var t=e[a];e.splice(a,1),e.splice(o,0,t)}var g=this;g.currentPage=0,g.pageSize=10,g.pagesSize=[10,25,50,100],g.formData.pages&&g.formData.pages.length||(g.formData.pages=[],g.formData.pages.push(t(1))),g.options=o.$init(g.options),g.numberOfPages=function(){return Math.ceil(g.formData.pages.length/g.pageSize)},g.lastPage=function(){g.currentPage=Math.ceil(g.formData.pages.length/g.pageSize-1)},g.addPage=function(){g.lastPage(),g.formData.pages.push(t(g.formData.pages.length+1))},g.onChangePageSize=function(){g.currentPage>Math.ceil(g.formData.pages.length/g.pageSize-1)&&(g.currentPage=Math.ceil(g.formData.pages.length/g.pageSize-1))},g.addPageAfter=function(e){var a=g.formData.pages.indexOf(e),o=a+1,n=t(e.number+1);o<g.formData.pages.length?g.formData.pages.splice(o,0,n):g.formData.pages.push(n),r()},g.moveDownPage=function(e){var a=g.formData.pages.indexOf(e),o=a+1;o<g.formData.pages.length&&n(g.formData.pages,a,o),r()},g.moveUpPage=function(e){var a=g.formData.pages.indexOf(e),o=a-1;o>=0&&n(g.formData.pages,a,o),r()},g.removePage=function(e){var a=g.formData.pages.indexOf(e);g.formData.pages.splice(a,1),r()},g.api&&(g.api.reset=function(){for(var e in g.formData)g.formData.hasOwnProperty(e)&&"pages"!=e&&delete g.formData[e];g.formData.pages.length=0,g.formData.pages.push(t(1))})}],link:function(e,a,o){var t=e.ctrl;t.formStatus&&(t.formStatus.form=t.form),t.possiblePageFlow=[];var r={nextPage:!0,label:"mwForm.pageFlow.goToNextPage"};t.possiblePageFlow.push(r),t.isSamePageFlow=function(e,a){return e.page&&a.page&&e.page.id==a.page.id||e.formSubmit&&a.formSubmit||e.nextPage&&a.nextPage},t.updatePageFlow=function(){t.possiblePageFlow.length=1,t.formData.pages.forEach(function(e){t.possiblePageFlow.push({page:{id:e.id,number:e.number},label:"mwForm.pageFlow.goToPage"})}),t.possiblePageFlow.push({formSubmit:!0,label:"mwForm.pageFlow.submitForm"}),t.formData.pages.forEach(function(e){t.possiblePageFlow.forEach(function(a){e.pageFlow?t.isSamePageFlow(a,e.pageFlow)&&(e.pageFlow=a):e.pageFlow=r,e.elements.forEach(function(e){var o=e.question;o&&o.pageFlowModifier&&o.offeredAnswers.forEach(function(e){e.pageFlow&&t.isSamePageFlow(a,e.pageFlow)&&(e.pageFlow=a)})})})})},e.$watch("ctrl.formData.pages.length",function(e,a){t.updatePageFlow()})}}}),angular.module("mwFormBuilder").filter("mwStartFrom",function(){return function(e,a){return a=+a,e.slice(a)}});
angular.module("mwFormBuilder").constant("MW_QUESTION_TYPES",["text","textarea","radio","checkbox","grid","priority","division","number","date","time","email","range","url"]).constant("MW_ELEMENT_TYPES",["question","image","paragraph"]).factory("mwFormBuilderOptions",["MW_ELEMENT_TYPES","MW_QUESTION_TYPES",function(e,t){function n(e,t){return e?e.map(function(e){return angular.extend({},t,e)}):[]}var l={title:null,icon:null,text:null,callback:null,filter:null,showInOpen:!1,showInPreview:!0,cssClass:""},u={key:null,label:null,selects:[],required:!0},r={elementTypes:e,questionTypes:t,elementButtons:[],customQuestionSelects:[],customElements:[]},o={$init:function(e){return angular.extend(o,r,e),o.customQuestionSelects=n(o.customQuestionSelects,u),o.elementButtons=n(o.elementButtons,l),o}};return o}]);
angular.module("mwFormBuilder").directive("wdFocusMe",["$timeout","$parse",function(n,u){return{link:function(o,t,c){var i=u(c.wdFocusMe);o.$watch(i,function(u){u===!0&&n(function(){t[0].focus()})}),t.bind("blur",function(){o.$apply(i.assign(o,!1))})}}}]).factory("focus",["$timeout","$window",function(n,u){return function(o){n(function(){var n=u.document.getElementById(o);n&&n.focus()})}}]);
"use strict";angular.module("mwFormBuilder").directive("mwConfirmClick",["$window",function(i){return{restrict:"A",link:function(n,r,c){var o=c.wdConfirmClick||"Are you sure?";r.bind("click",function(r){i.confirm(o)&&n.$apply(c.confirmedAction)})}}}]);